<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>

    <link rel="stylesheet" href="admin.css?v=5" />
    <link rel="stylesheet" href="toast.css?v=5" />

    <script>
      if (!localStorage.getItem("adminToken")) {
        window.location.replace("index.html");
      }
    </script>
  </head>

  <body>
    <!-- HONEYPOT TO DEFEAT BROWSER AUTOFILL -->
    <div style="position: absolute; left: -9999px; top: -9999px;">
        <input type="text" name="username" tabindex="-1" autocomplete="on">
        <input type="password" name="password" tabindex="-1" autocomplete="on">
    </div>

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h2>TrackFast</h2>
      <ul>
        <li onclick="navTo('admin.html')">Dashboard</li>
        <li onclick="navTo('admin.html')">Parcels</li>
        <li onclick="navTo('parcel.html')">Create Parcel</li>
        <li id="navTeam" style="display:none" onclick="openAdminModal()">Manage Team</li>

        <li
          onclick="localStorage.removeItem('adminToken'); window.location.href='index.html'"
        >
          Logout
        </li>
      </ul>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <h1>Admin Dashboard</h1>

      <!-- STATS -->
      <div class="stats">
        <div class="card">
          <h3>Total Parcels</h3>
          <p id="total">0</p>
        </div>
        <div class="card">
          <h3>Active</h3>
          <p id="active">0</p>
        </div>
        <div class="card">
          <h3>Paused</h3>
          <p id="paused">0</p>
        </div>
        <div class="card">
          <h3>Delivered</h3>
          <p id="delivered">0</p>
        </div>
      </div>

      <div class="filters">
        <input
          type="text"
          id="tf_search_query"
          placeholder="Search by Tracking ID..."
          autocomplete="off"
        />

        <select id="statusFilter">
          <option value="">All Statuses</option>
          <option>Order Received</option>
          <option>Processing</option>
          <option>Dispatched</option>
          <option>In Transit</option>
          <option>Out for Delivery</option>
          <option>Delivered</option>
        </select>

        <select id="stateFilter">
          <option value="">All States</option>
          <option value="active">Active</option>
          <option value="paused">Paused</option>
        </select>
      </div>

      <!-- TABLE -->
      <div class="table-box">
        <h2>Parcels</h2>
        <table>
          <thead>
            <tr>
              <th>Tracking ID</th>
              <th>Status</th>
              <th>Location</th>
              <th>State</th>
              <th style="width: 320px">Action</th>
            </tr>
          </thead>
          <tbody id="parcelTable"></tbody>
        </table>
      </div>
    </main>

    <!-- UPDATE MODAL -->
    <div class="modal" id="updateModal" style="display: none">
      <div class="modal-card">
        <div class="modal-head">
          <h3>Add Tracking Update</h3>
          <button class="modal-x" type="button" data-close="updateModal">
            âœ•
          </button>
        </div>

        <div class="modal-body">
          <label>Status</label>
          <select id="updateStatus"></select>

          <label>Location</label>
          <input
            id="updateLocation"
            type="text"
            placeholder="e.g. Accra, Ghana"
          />
        </div>

        <div class="modal-actions">
          <button id="cancelUpdate" type="button" class="btn-soft">
            Cancel
          </button>
          <button id="saveUpdate" type="button" class="btn-primary">
            Save Update
          </button>
        </div>
      </div>
    </div>

    <!-- EDIT MODAL -->
    <div class="modal" id="editModal" style="display: none">
      <div class="modal-card modal-card-scroll">
        <div class="modal-head">
          <h3>Edit Parcel</h3>
          <button class="modal-x" type="button" data-close="editModal">
            âœ•
          </button>
        </div>

        <div class="modal-body">
          <label>Sender</label>
          <input id="editSender" type="text" placeholder="Sender name" />

          <label>Receiver</label>
          <input id="editReceiver" type="text" placeholder="Receiver name" />

          <label>Contact</label>
          <input id="editContact" type="text" placeholder="Phone / Email" />

          <label>Origin</label>
          <input id="editOrigin" type="text" placeholder="Origin" />

          <label>Destination</label>
          <input id="editDestination" type="text" placeholder="Destination" />

          <label>Estimated Delivery</label>
          <input id="editEstimated" type="date" />

          <label>Status</label>
          <select id="editStatus"></select>
        </div>

        <div class="modal-actions">
          <button id="cancelEdit" type="button" class="btn-soft">Cancel</button>
          <button id="saveEdit" type="button" class="btn-primary">
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- âœ… NEW: PAUSE REASON MODAL -->
    <div class="modal" id="pauseModal" style="display: none">
      <div class="modal-card">
        <div class="modal-head">
          <h3>Pause Parcel</h3>
          <button class="modal-x" type="button" data-close="pauseModal">
            âœ•
          </button>
        </div>

        <div class="modal-body">
          <p style="margin-bottom: 10px; opacity: 0.85">
            Add a reason to show customers while tracking is paused.
          </p>

          <div class="danger-box" style="margin-bottom: 12px">
            <span>Tracking ID</span>
            <strong id="pauseParcelId">â€”</strong>
          </div>

          <label>Pause message</label>
          <textarea
            id="pauseMessage"
            rows="3"
            placeholder="e.g. Customs delay..."
          ></textarea>
        </div>

        <div class="modal-actions">
          <button id="cancelPause" type="button" class="btn-soft">
            Cancel
          </button>
          <button id="confirmPause" type="button" class="btn-primary">
            Pause Now
          </button>
        </div>
      </div>
    </div>

    <!-- DELETE CONFIRM MODAL -->
    <div class="modal" id="deleteModal" style="display: none">
      <div class="modal-card">
        <div class="modal-head">
          <h3>Delete Parcel</h3>
          <button class="modal-x" type="button" data-close="deleteModal">
            âœ•
          </button>
        </div>

        <div class="modal-body">
          <p class="danger-text">This action cannot be undone.</p>
          <div class="danger-box">
            <span>Tracking ID</span>
            <strong id="deleteParcelId">â€”</strong>
          </div>
        </div>

        <div class="modal-actions">
          <button id="cancelDelete" type="button" class="btn-soft">
            Cancel
          </button>
          <button id="confirmDelete" type="button" class="btn-danger">
            Yes, Delete
          </button>
        </div>
      </div>
    </div>

    <div class="modal" id="messagesModal" style="display: none">
      <div class="modal-card">
        <div class="modal-head">
          <div class="chat-title">
            <span>ðŸ’¬</span>
            <div class="chat-title-text">
                <b>Support Chat</b>
                <small>Active Conversation</small>
            </div>
          </div>
          <button class="modal-x" type="button" data-close="messagesModal">âœ•</button>
        </div>
        <div class="modal-body admin-chat-wrap">
           <div class="danger-box">
            <span>Tracking ID</span>
            <strong id="msgParcelId">â€”</strong>
          </div>
          <div id="adminChatBody" class="admin-chat-body">
            <!-- Messages injected here -->
          </div>
          <div class="admin-chat-footer">
            <input type="text" id="adminChatInput" placeholder="Type a reply..." />
            <button id="adminChatSendBtn" type="button" class="btn-primary">Send</button>
          </div>
        </div>
      </div>
    </div>

    <div id="toast-root"></div>
 
    <!-- NEW ADMIN MODAL -->
    <div class="modal" id="newAdminModal" style="display: none">
      <div class="modal-card">
        <div class="modal-head">
          <h3>Manage Team</h3>
          <button class="modal-x" type="button" data-close="newAdminModal">âœ•</button>
        </div>
        <div class="modal-body">
          <div style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px;">
            <h4 style="margin-bottom: 10px;">Create New Admin</h4>
            <label>Email</label>
            <input id="newAdminEmail" type="email" placeholder="admin@example.com" />
            <label>Password</label>
            <input id="newAdminPassword" type="password" placeholder="Password" />
            <div style="text-align: right; margin-top: 10px;">
                <button id="createAdminBtn" class="btn-primary" type="button">Create Admin</button>
            </div>
          </div>
          
          <div>
            <h4 style="margin-bottom: 10px;">Existing Admins</h4>
            <div id="adminsList" style="max-height: 200px; overflow-y: auto;">
                <!-- Injected via JS -->
                <p style="color: #888; text-align: center;">Loading...</p>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- VIEW PARCEL MODAL -->
    <div class="modal" id="viewModal" style="display: none">
      <div class="modal-card modal-card-scroll">
        <div class="modal-head">
          <h3>Parcel Details</h3>
          <button class="modal-x" type="button" data-close="viewModal">âœ•</button>
        </div>
        <div class="modal-body">
             <div class="tf-wrap id-view-wrap">
                <!-- Parcel Details Injected Here -->
             </div>
        </div>
      </div>
    </div>

    <!-- RESET PASSWORD MODAL -->

    <div class="modal" id="resetPasswordModal" style="display: none">
      <div class="modal-card">
        <div class="modal-head">
          <h3>Reset Password</h3>
          <button class="modal-x" type="button" data-close="resetPasswordModal">âœ•</button>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 10px;">Reset password for <strong id="resetAdminEmail">...</strong></p>
          <label>New Password</label>
          <input id="resetAdminNewPass" type="password" placeholder="New Password" />
        </div>
        <div class="modal-actions">
           <button id="cancelResetPass" type="button" class="btn-soft">Cancel</button>
           <button id="saveResetPass" type="button" class="btn-primary">Save New Password</button>
        </div>
      </div>
    </div>

    <script src="toast.js?v=5"></script>
    <script src="admin.js?v=9"></script>
  </body>
</html>
